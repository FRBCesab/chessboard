---
title: "Get started"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Get started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r include=FALSE}
knitr::opts_chunk$set(collapse  = TRUE,
                      comment   = "#>",
                      out.width = "100%",
                      dpi       = 96,
                      fig.align = "center")
```


The aim of the package `bridge` is to [...]


\


```{r 'setup'}
library("bridge")
library("ggplot2")
```


\


First let's define a custom theme for the `ggplot2` visualizations.


```{r 'ggplot-theme'}
custom_theme <- function() {
  theme_light() + 
  theme(plot.title   = element_text(face = "bold", family = "serif", size = 18),
        plot.caption = element_text(face = "italic", family = "serif"),
        axis.title   = element_blank(),
        axis.text    = element_text(family = "serif"))
}
```


\


## Provided data



The package `bridge` comes with two datasets:

- **Adour river**, an `sf` spatial object of type `LINESTRING` providing the 
geometry of the French river _L'Adour_;
- **Adour sites**, a `data.frame` with sites labels and sites coordinates along
the river.


\


### Adour river



Let's import the **Adour river** spatial layer.


```{r 'import-adour-river'}
# Import the spatial layer of Adour river ----
path_to_file <- system.file("extdata", "adour_lambert93.gpkg", package = "bridge")
adour_river  <- sf::st_read(path_to_file, quiet = TRUE)

head(adour_river)
```

This layer is an [`sf`](https://cran.r-project.org/package=sf) spatial object 
of type `LINESTRING` and contains one single row (geometry) defined in the 
[RGF93 / Lambert-93](https://epsg.io/2154) projection.


\


Now let's import a base map of France to locate the Adour river using the package
[`rnaturalearth`](https://cran.r-project.org/package=rnaturalearth).


```{r 'get-basemap'}
# Import France departments ----
france <- rnaturalearth::ne_states("france", returnclass = "sf")

# Remove overseas territories ----
france <- france[grep("^FR\\.", france$"code_hasc"), ]

# Project layer to RGF93 / Lambert-93 system ----
france <- sf::st_transform(france, sf::st_crs(adour_river))
```


\


Let's locate the Adour river of the France map.


```{r 'map-adour-river', fig.height=10, fig.width=10, out.width='80%'}
# Get extent of Adour river ----
adour_extent <- sf::st_bbox(adour_river)
adour_extent <- adour_extent + c(-10000, -10000, 10000, 10000)

ggplot(data = france) +
  geom_sf(fill = "lightgray", col = "white", size = 0.2) +
  geom_sf(data = adour_river, col = "steelblue") +
  geom_sf(data = sf::st_as_sfc(adour_extent), fill = NA, size = 0.3) +
  labs(title   = "The French river Adour", 
       caption = "RGF93 / Lambert-93 Projection") +
  custom_theme()
```


\


### Adour sites



Let's import the **Adour sites** data representing survey sites around the Adour.


```{r 'import-adour-sites'}
## Import the dataset of sites ----
path_to_file <- system.file("extdata", "adour_sites_coords.csv", 
                            package = "bridge")
adour_sites  <- read.csv(path_to_file)
adour_sites
```


[...]


\


Let's convert this `data.frame` into an `sf` object of type `POINT`.

```{r 'df-to-sf', fig.height=10, fig.width=12}
# Convert data.frame to sf object ----
adour_sites_sf <- sf::st_as_sf(adour_sites, coords = 2:3, crs = "epsg:2154")
adour_sites_sf
```


[...]


\


Finally, let's map these sites and the Adour river.


```{r 'map-adour-sites', fig.height=10, fig.width=12, out.width='80%'}
ggplot(data = adour_river) +
  geom_sf(col = "steelblue") +
  geom_sf(data = adour_sites_sf, shape = 19) +
  geom_label(data = adour_sites, aes(x = longitude, y = latitude, label = site), 
            size = 4.2, nudge_x = 5000, family = "serif") +
  labs(title   = "Study area (French river Adour)", 
       caption = "RGF93 / Lambert-93 Projection") +
  custom_theme() +
  geom_segment(aes(x = 454180, xend = 440170, y = 6216290, yend = 6263320), 
               arrow = arrow(length = unit(0.75, 'cm'), type = 'closed'),
               size  = 2.25)
```



## Nodes and Edges


### Nodes list


### Edges list




## TO REVIEW



From the sites labels, we will create an adjacency table based on a degree **1**
of neighborhood. This means that a site is linked to the first next site 
(upstream) and also to the first previous site (downstream).

**Important:** as the sites have a direction (along the Adour river, from 
upstream to downstream), the order of the sites must be found in the sites labels.

For instance, in our dataset, the sites are labelled as **S-01**, **S-02**, 
..., **S-10**. This means that the most upstream site is **S-01** and the
most downstream is **S-10**.

But be aware that ordering characters can have some unwanted effects, especially if 
they contain numbers.

For instance,

```{r 'order-labels'}
# Alphanumerical ordering ----
sites <- c( "s1",  "s2", "s11", "s10")
sort(sites)

# Natural ordering ----
sites <- c("s01", "s02", "s11", "s10")
sort(sites)
```

You may want to code your sites as in the second example, i.e. based on a Natural 
ordering.

<br />

Let's create this adjacency table with the function `bridge::edges_list()`

```{r 'adjacency-table'}
# Retrieve nodes (from nodes vector) ----
adour_nodes <- nodes_list(adour_sites$"site")
adour_nodes

# List of edges with degree 1 of neighborhood ----
adour_edges <- edges_list(adour_nodes, degree = 1)
```



```{r 'kable-adjacency-table', echo=FALSE}
knitr::kable(adour_edges, row.names = FALSE,
             caption = "Adjacency table of degree 1 of neighborhood", 
             align   = rep("c", ncol(adour_edges)))
```


We can convert this table to an adjacency matrix with function
`bridge::adjacency_matrix()`.




---
title: "Get started"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Get started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r include=FALSE}
knitr::opts_chunk$set(collapse  = TRUE,
                      comment   = "#>",
                      out.width = "100%")
```


```{r 'setup'}
library("bridge")
library("ggplot2")
```


## Provided datasets

The package `bridge` comes with two datasets:

- **Adour river**, an `sf` spatial object of type `LINESTRING` prividing the 
geometry of the French river _L'Adour_;
- **Adour survey**, a `data.frame` with sites labels and sites coordinates. Note 
that for this tutorial these sites are fictive.


First let's load the **Adour river** layer:


```{r 'load-adour-river', fig.height=10, fig.width=12}
## Path the example layer ----

path_to_file <- system.file("extdata", "adour_lambert93.gpkg", package = "bridge")


## Load the spatial layer ----

adour_river <- sf::st_read(path_to_file)


## Preview ----

print(adour_river)


## Map ----

ggplot(data = adour_river) +
  geom_sf(col = "steelblue") +
  theme_light() + 
  theme(plot.title = element_text(face = "bold", family = "serif")) +
  ggtitle("The French river Adour")
```


Now, let's load the sites around the Adour:

```{r 'load-adour-sites'}
## Path the example layer ----

path_to_file <- system.file("extdata", "sites_coords.rds", package = "bridge")


## Load the spatial layer ----

adour_sites <- readRDS(path_to_file)
```


```{r 'kable-adour-sites', echo=FALSE}
knitr::kable(adour_sites, 
             caption = "Sites around the French river Adour", 
             align   = c("c", "r", "r"))
```


Let's convert this `data.frame` to an `sf` object of type `POINT`:

```{r 'df-to-sf', fig.height=10, fig.width=12}
## Convert data.frame to sf object ----

adour_sites_sf <- sf::st_as_sf(adour_sites, coords = 2:3, crs = "epsg:2154")


## Map ----

ggplot(data = adour_river) +
  geom_sf(col = "steelblue") +
  geom_sf(data = adour_sites_sf, shape = 19) +
  theme_light() + 
  theme(plot.title = element_text(face = "bold", family = "serif")) +
  ggtitle("Survey around the French river Adour")
```


## Adjacency table

From the sites labels, we will create an adjacency table based on a degree **1**
of neighborhood. This means that a site is linked to the first next site 
(upstream) and also to the first previous site (downstream).

**Important:** as the sites have a direction (along the Adour river, from 
upstream to downstream), the order of the sites must be found in the sites labels.

For instance, in our dataset, the sites are labelled as **Site_1**, **Site_2**, 
..., **Site_10**. This means that the most upstream site is **Site_1** and the
most downstream is **Site_10**.

But be aware that ordering characters can have some unwanted effects, especially if 
they contain numbers.

For instance,

```{r 'order-labels'}
## Alphanumerical ordering ----

sites <- c( "s1",  "s2", "s11", "s10")
sort(sites)


## Natural ordering ----

sites <- c("s01", "s02", "s11", "s10")
sort(sites)
```

You may want to code your sites as in the second example, i.e. based on a Natural 
ordering.

Let's create this adjacency table with the function `bridge::adjacency_table()`

```{r 'adjacency-table'}
## Create adjacency table (degree 1 of neighborhood) ----

adj_table <- adjacency_table(adour_sites$"site", level = 1, self = FALSE)
```



```{r 'kable-adjacency-table', echo=FALSE}
knitr::kable(adj_table, 
             caption = "Adjacency table of degree 1 of neighborhood", 
             align   = c("c", "c", "c"))
```


We can convert this table to an adjacency matrix with function
`bridge::df_to_matrix()`.


```{r 'df-matrix'}
## Convert data frame to adjacency matrix ----

mat <- df_to_matrix(adj_table)
```


```{r echo = FALSE}
mat[1:6, 1:6]
```

